<html>
<body>
<my-root></my-root>
<script type="module">
  import {Component, PathRouter, RouteLink, defineFunction, setLogLevel} from "./lib/index.js";
  setLogLevel("debug");

  let rootRef;
  /*customElements.define(PathRouter.tagName, PathRouter);

  customElements.define(RouteLink.tagName, RouteLink);*/
  defineFunction("path-router", PathRouter);
  defineFunction("route-link", RouteLink);

  customElements.define("nav-component", class extends Component {

    static get observedAttributes() {
      return ['data-count'];
    }

    attributeChangedCallback(name, oldValue, newValue) {
      this.refresh();
    }

    click() {
      this.dispatchEvent(new CustomEvent("nav-click", {
        detail: parseInt(this.dataset.count, 10) + 1
      }))
    }

    render() {
      return '<div><p data-on-click="{this.click}">nav {this.dataset.count}</p></div>';
    }
  });

  customElements.define("home-page", class extends Component {
    render() {
      return "<p>home page</p>";
    }
  });

  customElements.define("not-found", class extends Component {
    render() {
      return '<p>not found</p><route-link data-path="/"><a href="#">home</a></route-link>';
    }
  });

  customElements.define("my-root", class extends Component {
    constructor() {
      super();
      this.state.count = 0;
      this.state.routes = JSON.stringify([{
          path: "/404",
          element: "not-found"
        }, {
          path: "/",
          element: "home-page"
        }]);
      this.state.defaultElement = "not-found";
    }

    navClick(ev) {
      this.setState({
        count: ev.detail
      });
    }

    render() {
      return '<nav-component data-count="{this.state.count}" data-on-nav-click="{this.navClick}"/><path-router data-routes="{this.state.routes}" data-default-element="{this.state.defaultElement}"/>'
    }
  });
</script>
</body>
</html>
