<!DOCTYPE html>
<html>
<body>
<style>
  body {
    background-color: black;
    color: white;
  }
</style>
<my-root></my-root>
<script type="module">
  import {defineFunction} from "./lib/index.js";

  defineFunction("my-element", async function ({abortSignal}) {
    await new Promise(resolve => {
      setTimeout(() => {
        resolve();
      }, 4000);
    });
    if (abortSignal.aborted) {
      console.log("ABORTED");
      return;
    }
    return "<p>out</p>";
  });

  defineFunction("my-root", async function () {
    const [show, setShow] = this.useState(true);
    this.useEffect(() => {
      const timeout = setTimeout(() => {
        setShow(false);
      }, 2000);
      return () => {
        clearTimeout(timeout);
      }
    });

    return {
      template: '<my-element/><my-element data-if="{show}"/>',
      values: {
        show
      }
    };
  });
</script>
</body>
</html>
