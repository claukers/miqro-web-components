<!DOCTYPE html>
<html>
<body>
<root-component>
</root-component>
<script type="module">
  import {defineFunction} from "./lib/index.js";

  defineFunction("root-component", function () {
    const [showChildren, setShowChildren] = this.useState(true);
    const [initialCount, setInitialCount] = this.useState(0);
    //console.log("showChildren %s", showChildren);
    return {
      template: `<p data-on-click="{toggleShow}">children start</p><div data-if="{showChildren}"><label-fn data-count="{initialCount}"/></div><p data-on-click="{resetCount}">children end</p>`,
      values: {
        showChildren,
        initialCount,
        resetCount: () => {
          setInitialCount(initialCount + 1);
        },
        toggleShow: (ev) => {
          ev.preventDefault();
          setShowChildren(!showChildren);
        }
      }
    }
  })

  defineFunction("label-fn", async function () {
    const [initialCount, setInitialCount] = this.useState(0);

    const [count, setCount] = this.useState(0);
    console.log("render " + count);
    this.useEffect(() => {
      console.log("effect on");
      return () => {
        console.log("effect off");
      }
    });

    const initialCountAttribute = this.useAttribute("data-count", "0");

    if (initialCount != initialCountAttribute) {
      const newInitialCount = parseInt(initialCountAttribute, 10);
      setCount(newInitialCount);
      setInitialCount(newInitialCount);
    }

    return {
      template: '<p data-on-click="{click}">click count {count}</p><p>initial Count {initialCount}</p>',
      values: {
        initialCount,
        count,
        click: function (ev) {
          //console.dir(ev);
          ev.preventDefault();
          setCount(count + 1);
        }
      }
    }
  });

</script>
</body>
</html>
