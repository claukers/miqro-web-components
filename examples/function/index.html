<!DOCTYPE html>
<html>
<body>
<root-component>
</root-component>
<script type="module">
  import {defineFunction} from "./lib/index.js";

  defineFunction("root-component", async function () {
    console.log("root-component");
    const [showChildren, setShowChildren] = this.useState(true);
    const [initialCount, setInitialCount] = this.useState(0);
    const [limit] = this.useQuery("limit", 0);
    //console.log("showChildren %s", showChildren);
    return {
      template: `<p data-on-click="{toggleShow}">children start</p><div data-if="{showChildren}"><label-fn data-count="{initialCount}"/></div><p data-on-click="{resetCount}">children end {limit}</p>`,
      values: {
        limit,
        showChildren,
        initialCount,
        resetCount: () => {
          setInitialCount(initialCount + 1);
        },
        toggleShow: (ev) => {
          ev.preventDefault();
          setShowChildren(!showChildren);
        }
      }
    }
  })

  defineFunction("label-fn", async function () {
    console.log("label-fn");
    const [initialCount, setInitialCount] = this.useState(0);

    const [count, setCount] = this.useState(0);
    console.log("label-fn count " + count);
    this.useEffect(() => {
      console.log("label-fn effect on");
      return () => {
        console.log("label-fn effect off");
      }
    });

    const initialCountAttribute = this.useAttribute("data-count", "0");// this.attributes["data-count"].value;

    if (initialCount != initialCountAttribute) {
      const newInitialCount = parseInt(initialCountAttribute, 10);
      setCount(newInitialCount);
      setInitialCount(newInitialCount);
    }

    const [limit, setLimit] = this.useQuery("limit", 0);

    return {
      template: '<p data-on-click="{click}">click count {count}</p><p>initial Count {initialCount}</p><p>limit {limit}</p>',
      values: {
        limit,
        initialCount,
        count,
        click: function (ev) {
          ev.preventDefault();
          setCount(count + 1);
          setLimit(count + 1);

        }
      }
    }
  });

</script>
</body>
</html>
